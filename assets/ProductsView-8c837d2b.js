import{p as de,aT as ce,aU as he,g as ve,D as ee,aV as we,aW as me,o as T,aX as ke,u as fe,aY as ge,aZ as q,a_ as le,x as d,c as a,H as G,a$ as Ce,b0 as Pe,b1 as Se,b2 as Fe,s as _e,I as Be,A as Ie,z as $,B as Ue,b3 as Ae,b4 as Me,a8 as W,U as oe,al as Re,b5 as De,b6 as Te,b7 as ze,as as X,b8 as He,v as Ne,y as $e,Y as Ee,ah as Y,a1 as ne,a2 as J,a3 as Ge,a5 as v,b9 as Ke,a7 as ae,K as L,aa as j,az as Z,ba as Le,V as je,a4 as se,a6 as re,ae as s,ay as qe,aK as Oe,aH as We,ac as Xe,bb as Ye,bc as Je,aJ as Ze,bd as Qe,X as ie}from"./index-2802028b.js";import{c as ea,a as Q,d as aa,e as ta,u as la,b as E}from"./index.esm-587f960a.js";import{V as oa}from"./VContainer-376f5167.js";import{V as na,a as ue}from"./VRow-3c50d4c9.js";import{V as sa}from"./VForm-1e8075d7.js";import"./_commonjsHelpers-39b5b250.js";/* empty css              */const ra=de({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...ce(),...he()},"VSwitch"),ia=ve()({name:"VSwitch",inheritAttrs:!1,props:ra(),emits:{"update:focused":e=>!0,"update:modelValue":()=>!0,"update:indeterminate":e=>!0},setup(e,B){let{attrs:C,slots:b}=B;const r=ee(e,"indeterminate"),c=ee(e,"modelValue"),{loaderClasses:P}=we(e),{isFocused:I,focus:A,blur:S}=me(e),M=T(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),w=ke(),R=T(()=>e.id||`switch-${w}`);function x(){r.value&&(r.value=!1)}return fe(()=>{const[h,F]=ge(C),[D,U]=q.filterProps(e),[z,K]=le.filterProps(e),_=d();function H(m){var g,p;m.stopPropagation(),m.preventDefault(),(p=(g=_.value)==null?void 0:g.input)==null||p.click()}return a(q,G({class:["v-switch",{"v-switch--inset":e.inset},{"v-switch--indeterminate":r.value},P.value,e.class],style:e.style},h,D,{id:R.value,focused:I.value}),{...b,default:m=>{let{id:g,messagesId:p,isDisabled:V,isReadonly:f,isValid:o}=m;return a(le,G({ref:_},z,{modelValue:c.value,"onUpdate:modelValue":[i=>c.value=i,x],id:g.value,"aria-describedby":p.value,type:"checkbox","aria-checked":r.value?"mixed":void 0,disabled:V.value,readonly:f.value,onFocus:A,onBlur:S},F),{...b,default:()=>a("div",{class:"v-switch__track",onClick:H},null),input:i=>{let{textColorClasses:u,textColorStyles:y}=i;return a("div",{class:["v-switch__thumb",u.value],style:y.value},[e.loading&&a(Ce,{name:"v-switch",active:!0,color:o.value===!1?void 0:M.value},{default:n=>b.loader?b.loader(n):a(Pe,{active:n.isActive,color:n.color,indeterminate:!0,size:"16",width:"2"},null)})])}})}})}),{}}});const ua=de({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ce(),...Se()},"VTextarea"),da=ve()({name:"VTextarea",directives:{Intersect:Fe},inheritAttrs:!1,props:ua(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,B){let{attrs:C,emit:b,slots:r}=B;const c=ee(e,"modelValue"),{isFocused:P,focus:I,blur:A}=me(e),S=T(()=>typeof e.counterValue=="function"?e.counterValue(c.value):(c.value||"").toString().length),M=T(()=>{if(C.maxlength)return C.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function w(o,i){var u,y;!e.autofocus||!o||(y=(u=i[0].target)==null?void 0:u.focus)==null||y.call(u)}const R=d(),x=d(),h=_e(""),F=d(),D=T(()=>e.persistentPlaceholder||P.value||e.active);function U(){var o;F.value!==document.activeElement&&((o=F.value)==null||o.focus()),P.value||I()}function z(o){U(),b("click:control",o)}function K(o){b("mousedown:control",o)}function _(o){o.stopPropagation(),U(),X(()=>{c.value="",He(e["onClick:clear"],o)})}function H(o){var u;const i=o.target;if(c.value=i.value,(u=e.modelModifiers)!=null&&u.trim){const y=[i.selectionStart,i.selectionEnd];X(()=>{i.selectionStart=y[0],i.selectionEnd=y[1]})}}const m=d(),g=d(+e.rows),p=T(()=>["plain","underlined"].includes(e.variant));Be(()=>{e.autoGrow||(g.value=+e.rows)});function V(){e.autoGrow&&X(()=>{if(!m.value||!x.value)return;const o=getComputedStyle(m.value),i=getComputedStyle(x.value.$el),u=parseFloat(o.getPropertyValue("--v-field-padding-top"))+parseFloat(o.getPropertyValue("--v-input-padding-top"))+parseFloat(o.getPropertyValue("--v-field-padding-bottom")),y=m.value.scrollHeight,n=parseFloat(o.lineHeight),t=Math.max(parseFloat(e.rows)*n+u,parseFloat(i.getPropertyValue("--v-input-control-height"))),N=parseFloat(e.maxRows)*n+u||1/0,k=$e(y??0,t,N);g.value=Math.floor((k-u)/n),h.value=Ne(k)})}Ie(V),$(c,V),$(()=>e.rows,V),$(()=>e.maxRows,V),$(()=>e.density,V);let f;return $(m,o=>{o?(f=new ResizeObserver(V),f.observe(m.value)):f==null||f.disconnect()}),Ue(()=>{f==null||f.disconnect()}),fe(()=>{const o=!!(r.counter||e.counter||e.counterValue),i=!!(o||r.details),[u,y]=ge(C),[{modelValue:n,...t}]=q.filterProps(e),[N]=Ae(e);return a(q,G({ref:R,modelValue:c.value,"onUpdate:modelValue":k=>c.value=k,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--plain-underlined":p.value},e.class],style:e.style},u,t,{centerAffix:g.value===1&&!p.value,focused:P.value}),{...r,default:k=>{let{isDisabled:l,isDirty:O,isReadonly:pe,isValid:Ve}=k;return a(Me,G({ref:x,style:{"--v-textarea-control-height":h.value},onClick:z,onMousedown:K,"onClick:clear":_,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},N,{active:D.value||O.value,centerAffix:g.value===1&&!p.value,dirty:O.value||e.dirty,disabled:l.value,focused:P.value,error:Ve.value===!1}),{...r,default:ye=>{let{props:{class:te,...be}}=ye;return a(W,null,[e.prefix&&a("span",{class:"v-text-field__prefix"},[e.prefix]),oe(a("textarea",G({ref:F,class:te,value:c.value,onInput:H,autofocus:e.autofocus,readonly:pe.value,disabled:l.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:U,onBlur:A},be,y),null),[[Re("intersect"),{handler:w},null,{once:!0}]]),e.autoGrow&&oe(a("textarea",{class:[te,"v-textarea__sizer"],"onUpdate:modelValue":xe=>c.value=xe,ref:m,readonly:!0,"aria-hidden":"true"},null),[[De,c.value]]),e.suffix&&a("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:i?k=>{var l;return a(W,null,[(l=r.details)==null?void 0:l.call(r,k),o&&a(W,null,[a("span",null,null),a(Te,{active:e.persistentCounter||P.value,value:S.value,max:M.value},r.counter)])])}:void 0})}),ze({},R,x,F)}});const ca={style:{background:"#d8e9ef"}},va=ae("h1",{class:"text-center",style:{color:"#454552"}},"商品管理",-1),ma={class:"d-flex flex-row-reverse justify-space-between"},fa={class:"textFieldWidth"},wa={__name:"ProductsView",setup(e){const B=Ee(),C=d(5),b=d([{key:"name",order:"asc"}]),r=d(1),c=d([]),P=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"商品名稱",align:"center",sortable:!0,key:"name"},{title:"商品價格",align:"center",sortable:!0,key:"price"},{title:"商品說明",align:"center",sortable:!1,key:"description"},{title:"商品分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],I=d(!1),A=d(0),S=d(""),M=()=>{r.value=1,w()},w=async()=>{I.value=!0;try{const{data:n}=await Y.get("/products/all",{params:{page:r.value,itemsPerPage:C.value,sortBy:b.value[0].key,sortOrder:b.value[0].order,search:S.value}});c.value.splice(0,c.value.length,...n.result.data),A.value=n.result.count}catch(n){B({text:n.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}I.value=!1};w();const R=n=>{h.value=n._id,m.value.value=n.name,g.value.value=n.price,p.value.value=n.description,V.value.value=n.category,f.value.value=n.sell,x.value=!0},x=d(!1),h=d(""),F=()=>{h.value="",x.value=!0},D=()=>{x.value=!1,H(),u.value.deleteFileRecord()},U=["鮮魚本舖","鮮蝦螃蟹","貝類軟體","調理珍饌","嚴選肉品","其他鮮貨"],z=ea({name:Q().required("缺少商品名稱"),price:aa().typeError("缺少商品價格").required("缺少商品價格").min(0,"價格錯誤,不得小於0元"),description:Q().required("缺少商品說明"),category:Q().required("缺少分類").test("isCategory",n=>U.includes(n)),sell:ta()}),{handleSubmit:K,isSubmitting:_,resetForm:H}=la({validationSchema:z,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),m=E("name"),g=E("price"),p=E("description"),V=E("category"),f=E("sell"),o=d([]),i=d([]),u=d(null),y=K(async n=>{if(!(h.value.length===0&&o.value.length===0))try{const t=new FormData;t.append("name",n.name),t.append("price",n.price),t.append("description",n.description),t.append("category",n.category),t.append("sell",n.sell),o.value.length>0&&t.append("image",o.value[0].file),h.value.length>0?await Y.patch("/products/"+h.value,t):await Y.post("/products",t),B({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),D(),w()}catch(t){console.log(t),B({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(n,t)=>{const N=ne("VDataTableServer"),k=ne("VueFileAgent");return J(),Ge("div",ca,[a(oa,null,{default:v(()=>[a(na,null,{default:v(()=>[a(ue,{cols:"12"},{default:v(()=>[va]),_:1}),a(ue,{id:"table",cols:"12"},{default:v(()=>[a(N,{"items-per-page":C.value,"onUpdate:itemsPerPage":[t[1]||(t[1]=l=>C.value=l),w],"sort-by":b.value,"onUpdate:sortBy":[t[2]||(t[2]=l=>b.value=l),w],page:r.value,"onUpdate:page":[t[3]||(t[3]=l=>r.value=l),w],items:c.value,headers:P,loading:I.value,"items-length":A.value,search:S.value,hover:""},{top:v(()=>[ae("div",ma,[a(L,{color:"primary",onClick:F,style:{margin:"15px"}},{default:v(()=>[j("新增商品")]),_:1}),ae("div",fa,[a(Z,{"append-icon":"mdi-magnify","onClick:append":M,onKeydown:Le(M,["enter"]),modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=l=>S.value=l)},null,8,["onKeydown","modelValue"])])])]),"item.image":v(({item:l})=>[a(je,{src:l.raw.image,height:"250px"},null,8,["src"])]),"item.sell":v(({item:l})=>[l.raw.sell?(J(),se(ie,{key:0,icon:"mdi-check",color:"danger"})):re("",!0),l.raw.sell?re("",!0):(J(),se(ie,{key:1,icon:"mdi-close",color:"danger"}))]),"item.edit":v(({item:l})=>[a(L,{icon:"mdi-pencil",onClick:O=>R(l.raw),variant:"text",color:"green"},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),a(Ke,{persistent:"",modelValue:x.value,"onUpdate:modelValue":t[11]||(t[11]=l=>x.value=l),width:"47%",scrollable:"",style:{"backdrop-filter":"blur(5px)"}},{default:v(()=>[a(sa,{disabled:s(_),onSubmit:qe(s(y),["prevent"])},{default:v(()=>[a(Oe,null,{default:v(()=>[a(We,null,{default:v(()=>[j(Xe(h.value.length>0?"編輯商品":"新增商品"),1)]),_:1}),a(Ye,null,{default:v(()=>[a(Z,{label:"商品名稱",modelValue:s(m).value.value,"onUpdate:modelValue":t[4]||(t[4]=l=>s(m).value.value=l),"error-messages":s(m).errorMessage.value},null,8,["modelValue","error-messages"]),a(Z,{label:"價格",modelValue:s(g).value.value,"onUpdate:modelValue":t[5]||(t[5]=l=>s(g).value.value=l),modelModifiers:{number:!0},"error-messages":s(g).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),a(da,{label:"商品說明",modelValue:s(p).value.value,"onUpdate:modelValue":t[6]||(t[6]=l=>s(p).value.value=l),"error-messages":s(p).errorMessage.value},null,8,["modelValue","error-messages"]),a(Je,{label:"商品分類",modelValue:s(V).value.value,"onUpdate:modelValue":t[7]||(t[7]=l=>s(V).value.value=l),"error-messages":s(V).errorMessage.value,items:U},null,8,["modelValue","error-messages"]),a(ia,{label:"上架",color:"primary",modelValue:s(f).value.value,"onUpdate:modelValue":t[8]||(t[8]=l=>s(f).value.value=l),"error-messages":s(f).errorMessage.value},null,8,["modelValue","error-messages"]),a(k,{modelValue:o.value,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value=l),"raw-model-value":i.value,"onUpdate:rawModelValue":t[10]||(t[10]=l=>i.value=l),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png,image/gif",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖曳至此",deletable:"",ref_key:"fileAgent",ref:u},null,8,["modelValue","raw-model-value"])]),_:1}),a(Ze,null,{default:v(()=>[a(Qe),a(L,{color:"danger",variant:"elevated",onClick:D,loading:s(_)},{default:v(()=>[j("取消")]),_:1},8,["loading"]),a(L,{color:"primary",variant:"elevated",type:"submit",loading:s(_)},{default:v(()=>[j("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])])}}};export{wa as default};
